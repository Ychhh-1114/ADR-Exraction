(function(b,a){if(typeof define==="function"&&define.amd){define("sifter",a)}else{if(typeof exports==="object"){module.exports=a()}else{b.Sifter=a()}}}(this,function(){var g=function(i,j){this.items=i;this.settings=j||{diacritics:true}};g.prototype.tokenize=function(m){m=h(String(m||"").toLowerCase());if(!m||!m.length){return[]}var j,l,o,k;var p=[];var q=m.split(/ +/);for(j=0,l=q.length;j<l;j++){o=d(q[j]);if(this.settings.diacritics){for(k in c){if(c.hasOwnProperty(k)){o=o.replace(new RegExp(k,"g"),c[k])}}}p.push({string:q[j],regex:new RegExp(o,"i")})}return p};g.prototype.iterator=function(k,i){var j;if(f(k)){j=Array.prototype.forEach||function(l){for(var m=0,o=this.length;m<o;m++){l(this[m],m,this)}}}else{j=function(l){for(var m in this){if(this.hasOwnProperty(m)){l(this[m],m,this)}}}}j.apply(k,[i])};g.prototype.getScoreFunction=function(m,j){var n,i,p,o;n=this;m=n.prepareSearch(m,j);p=m.tokens;i=m.options.fields;o=p.length;var l=function(t,s){var r,q;if(!t){return 0}t=String(t||"");q=t.search(s.regex);if(q===-1){return 0}r=s.string.length/t.length;if(q===0){r+=0.5}return r};var k=(function(){var q=i.length;if(!q){return function(){return 0}}if(q===1){return function(s,r){return l(r[i[0]],s)}}return function(u,r){for(var s=0,t=0;s<q;s++){t+=l(r[i[s]],u)}return t/q}})();if(!o){return function(){return 0}}if(o===1){return function(q){return k(p[0],q)}}if(m.options.conjunction==="and"){return function(q){var s;for(var r=0,t=0;r<o;r++){s=k(p[r],q);if(s<=0){return 0}t+=s}return t/o}}else{return function(q){for(var r=0,s=0;r<o;r++){s+=k(p[r],q)}return s/o}}};g.prototype.getSortFunction=function(u,t){var o,s,v,j,k,l,q,r,m,p,w;v=this;u=v.prepareSearch(u,t);w=(!u.query&&t.sort_empty)||t.sort;m=function(i,n){if(i==="$score"){return n.score}return v.items[n.id][i]};k=[];if(w){for(o=0,s=w.length;o<s;o++){if(u.query||w[o].field!=="$score"){k.push(w[o])}}}if(u.query){p=true;for(o=0,s=k.length;o<s;o++){if(k[o].field==="$score"){p=false;break}}if(p){k.unshift({field:"$score",direction:"desc"})}}else{for(o=0,s=k.length;o<s;o++){if(k[o].field==="$score"){k.splice(o,1);break}}}r=[];for(o=0,s=k.length;o<s;o++){r.push(k[o].direction==="desc"?-1:1)}l=k.length;if(!l){return null}else{if(l===1){j=k[0].field;q=r[0];return function(i,n){return q*b(m(j,i),m(j,n))}}else{return function(n,y){var B,C,x,z,A;for(B=0;B<l;B++){A=k[B].field;C=r[B]*b(m(A,n),m(A,y));if(C){return C}}return 0}}}};g.prototype.prepareSearch=function(m,l){if(typeof m==="object"){return m}l=e({},l);var i=l.fields;var j=l.sort;var k=l.sort_empty;if(i&&!f(i)){l.fields=[i]}if(j&&!f(j)){l.sort=[j]}if(k&&!f(k)){l.sort_empty=[k]}return{options:l,query:String(m||"").toLowerCase(),tokens:this.tokenize(m),total:0,items:[]}};g.prototype.search=function(m,l){var p=this,q,n,o,i;var k;var j;o=this.prepareSearch(m,l);l=o.options;m=o.query;j=l.score||p.getScoreFunction(o);if(m.length){p.iterator(p.items,function(s,r){n=j(s);if(l.filter===false||n>0){o.items.push({score:n,id:r})}})}else{p.iterator(p.items,function(s,r){o.items.push({score:1,id:r})})}k=p.getSortFunction(o,l);if(k){o.items.sort(k)}o.total=o.items.length;if(typeof l.limit==="number"){o.items=o.items.slice(0,l.limit)}return o};var b=function(i,j){if(typeof i==="number"&&typeof j==="number"){return i>j?1:(i<j?-1:0)}i=a(String(i||""));j=a(String(j||""));if(i>j){return 1}if(j>i){return -1}return 0};var e=function(j,l){var m,p,o,q;for(m=1,p=arguments.length;m<p;m++){q=arguments[m];if(!q){continue}for(o in q){if(q.hasOwnProperty(o)){j[o]=q[o]}}}return j};var h=function(i){return(i+"").replace(/^\s+|\s+$|/g,"")};var d=function(i){return(i+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")};var f=Array.isArray||($&&$.isArray)||function(i){return Object.prototype.toString.call(i)==="[object Array]"};var c={a:"[aÀÁÂÃÄÅàáâãäåĀāąĄ]",c:"[cÇçćĆčČ]",d:"[dđĐďĎ]",e:"[eÈÉÊËèéêëěĚĒēęĘ]",i:"[iÌÍÎÏìíîïĪī]",l:"[lłŁ]",n:"[nÑñňŇńŃ]",o:"[oÒÓÔÕÕÖØòóôõöøŌō]",r:"[rřŘ]",s:"[sŠšśŚ]",t:"[tťŤ]",u:"[uÙÚÛÜùúûüůŮŪū]",y:"[yŸÿýÝ]",z:"[zŽžżŻźŹ]"};var a=(function(){var m,q,o,j;var l="";var p={};for(o in c){if(c.hasOwnProperty(o)){j=c[o].substring(2,c[o].length-1);l+=j;for(m=0,q=j.length;m<q;m++){p[j.charAt(m)]=o}}}var r=new RegExp("["+l+"]","g");return function(i){return i.replace(r,function(k){return p[k]}).toLowerCase()}})();return g}));(function(b,a){if(typeof define==="function"&&define.amd){define("microplugin",a)}else{if(typeof exports==="object"){module.exports=a()}else{b.MicroPlugin=a()}}}(this,function(){var a={};a.mixin=function(c){c.plugins={};c.prototype.initializePlugins=function(g){var d,f,e;var j=this;var h=[];j.plugins={names:[],settings:{},requested:{},loaded:{}};if(b.isArray(g)){for(d=0,f=g.length;d<f;d++){if(typeof g[d]==="string"){h.push(g[d])}else{j.plugins.settings[g[d].name]=g[d].options;h.push(g[d].name)}}}else{if(g){for(e in g){if(g.hasOwnProperty(e)){j.plugins.settings[e]=g[e];h.push(e)}}}}while(h.length){j.require(h.shift())}};c.prototype.loadPlugin=function(d){var g=this;var f=g.plugins;var e=c.plugins[d];if(!c.plugins.hasOwnProperty(d)){throw new Error('Unable to find "'+d+'" plugin')}f.requested[d]=true;f.loaded[d]=e.fn.apply(g,[g.plugins.settings[d]||{}]);f.names.push(d)};c.prototype.require=function(d){var f=this;var e=f.plugins;if(!f.plugins.loaded.hasOwnProperty(d)){if(e.requested[d]){throw new Error('Plugin has circular dependency ("'+d+'")')}f.loadPlugin(d)}return e.loaded[d]};c.define=function(e,d){c.plugins[e]={name:e,fn:d}}};var b={isArray:Array.isArray||function(c){return Object.prototype.toString.call(c)==="[object Array]"}};return a}));(function(b,a){if(typeof define==="function"&&define.amd){define("selectize",["jquery","sifter","microplugin"],a)}else{if(typeof exports==="object"){module.exports=a(require("jquery"),require("sifter"),require("microplugin"))}else{b.Selectize=a(b.jQuery,b.Sifter,b.MicroPlugin)}}}(this,function(a,H,E){var i=function(N,P){if(typeof P==="string"&&!P.length){return}var Q=(typeof P==="string")?new RegExp(P,"i"):P;var O=function(W){var Y=0;if(W.nodeType===3){var X=W.data.search(Q);if(X>=0&&W.data.length>0){var T=W.data.match(Q);var Z=document.createElement("span");Z.className="highlight";var U=W.splitText(X);var R=U.splitText(T[0].length);var V=U.cloneNode(true);Z.appendChild(V);U.parentNode.replaceChild(Z,U);Y=1}}else{if(W.nodeType===1&&W.childNodes&&!/(script|style)/i.test(W.tagName)){for(var S=0;S<W.childNodes.length;++S){S+=O(W.childNodes[S])}}}return Y};return N.each(function(){O(this)})};var D=function(){};D.prototype={on:function(N,O){this._events=this._events||{};this._events[N]=this._events[N]||[];this._events[N].push(O)},off:function(N,O){var P=arguments.length;if(P===0){return delete this._events}if(P===1){return delete this._events[N]}this._events=this._events||{};if(N in this._events===false){return}this._events[N].splice(this._events[N].indexOf(O),1)},trigger:function(N){this._events=this._events||{};if(N in this._events===false){return}for(var O=0;O<this._events[N].length;O++){this._events[N][O].apply(this,Array.prototype.slice.call(arguments,1))}}};D.mixin=function(N){var P=["on","off","trigger"];for(var O=0;O<P.length;O++){N.prototype[P[O]]=D.prototype[P[O]]}};var k=/Mac/.test(navigator.userAgent);var m=65;var p=188;var x=13;var t=27;var u=37;var B=38;var w=80;var y=39;var s=40;var v=78;var n=8;var r=46;var z=16;var o=k?91:17;var q=k?18:17;var A=9;var K=1;var J=2;var I=!/android/i.test(window.navigator.userAgent)&&!!document.createElement("form").validity;var l=function(N){return typeof N!=="undefined"};var h=function(N){if(typeof N==="undefined"||N===null){return null}if(typeof N==="boolean"){return N?"1":"0"}return N+""};var e=function(N){return(N+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")};var f=function(N){return(N+"").replace(/\$/g,"$$$$")};var j={};j.before=function(Q,O,N){var P=Q[O];Q[O]=function(){N.apply(Q,arguments);return P.apply(Q,arguments)}};j.after=function(Q,O,N){var P=Q[O];Q[O]=function(){var R=P.apply(Q,arguments);N.apply(Q,arguments);return R}};var F=function(O){var N=false;return function(){if(N){return}N=true;O.apply(this,arguments)}};var c=function(O,N){var P;return function(){var R=this;var Q=arguments;window.clearTimeout(P);P=window.setTimeout(function(){O.apply(R,Q)},N)}};var d=function(P,S,O){var R;var Q=P.trigger;var N={};P.trigger=function(){var T=arguments[0];if(S.indexOf(T)!==-1){N[T]=arguments}else{return Q.apply(P,arguments)}};O.apply(P,[]);P.trigger=Q;for(R in N){if(N.hasOwnProperty(R)){Q.apply(P,N[R])}}};var M=function(N,O,Q,P){N.on(O,Q,function(S){var R=S.target;while(R&&R.parentNode!==N[0]){R=R.parentNode}S.currentTarget=R;return P.apply(this,[S])})};var g=function(N){var O={};if("selectionStart" in N){O.start=N.selectionStart;O.length=N.selectionEnd-O.start}else{if(document.selection){N.focus();var P=document.selection.createRange();var Q=document.selection.createRange().text.length;P.moveStart("character",-N.value.length);O.start=P.text.length-Q;O.length=Q}}return O};var L=function(N,O,R){var P,Q,S={};if(R){for(P=0,Q=R.length;P<Q;P++){S[R[P]]=N.css(R[P])}}else{S=N.css()}O.css(S)};var C=function(P,N){if(!P){return 0}var O=a("<test>").css({position:"absolute",top:-99999,left:-99999,width:"auto",padding:0,whiteSpace:"pre"}).text(P).appendTo("body");L(N,O,["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"]);var Q=O.width();O.remove();return Q};var b=function(N){var O=null;var P=function(R,T){var Y,S,V,U,Z;var X,Q,W;R=R||window.event||{};T=T||{};if(R.metaKey||R.altKey){return}if(!T.force&&N.data("grow")===false){return}Y=N.val();if(R.type&&R.type.toLowerCase()==="keydown"){S=R.keyCode;V=((S>=97&&S<=122)||(S>=65&&S<=90)||(S>=48&&S<=57)||S===32);if(S===r||S===n){W=g(N[0]);if(W.length){Y=Y.substring(0,W.start)+Y.substring(W.start+W.length)}else{if(S===n&&W.start){Y=Y.substring(0,W.start-1)+Y.substring(W.start+1)}else{if(S===r&&typeof W.start!=="undefined"){Y=Y.substring(0,W.start)+Y.substring(W.start+1)}}}}else{if(V){X=R.shiftKey;Q=String.fromCharCode(R.keyCode);if(X){Q=Q.toUpperCase()}else{Q=Q.toLowerCase()}Y+=Q}}}U=N.attr("placeholder");if(!Y&&U){Y=U}Z=C(Y,N)+4;if(Z!==O){O=Z;N.width(Z);N.triggerHandler("resize")}};N.on("keydown keyup update blur",P);P()};var G=function(N,V){var S,Q,T,P,R,U=this;R=N[0];R.selectize=U;var O=window.getComputedStyle&&window.getComputedStyle(R,null);P=O?O.getPropertyValue("direction"):R.currentStyle&&R.currentStyle.direction;P=P||N.parents("[dir]:first").attr("dir")||"";a.extend(U,{order:0,settings:V,$input:N,tabIndex:N.attr("tabindex")||"",tagType:R.tagName.toLowerCase()==="select"?K:J,rtl:/rtl/i.test(P),eventNS:".selectize"+(++G.count),highlightedValue:null,isOpen:false,isDisabled:false,isRequired:N.is("[required]"),isInvalid:false,isLocked:false,isFocused:false,isInputHidden:false,isSetup:false,isShiftDown:false,isCmdDown:false,isCtrlDown:false,ignoreFocus:false,ignoreBlur:false,ignoreHover:false,hasOptions:false,currentResults:null,lastValue:"",caretPos:0,loading:0,loadedSearches:{},$activeOption:null,$activeItems:[],optgroups:{},options:{},userOptions:{},items:[],renderCache:{},onSearchChange:V.loadThrottle===null?U.onSearchChange:c(U.onSearchChange,V.loadThrottle)});U.sifter=new H(this.options,{diacritics:V.diacritics});if(U.settings.options){for(Q=0,T=U.settings.options.length;Q<T;Q++){U.registerOption(U.settings.options[Q])}delete U.settings.options}if(U.settings.optgroups){for(Q=0,T=U.settings.optgroups.length;Q<T;Q++){U.registerOptionGroup(U.settings.optgroups[Q])}delete U.settings.optgroups}U.settings.mode=U.settings.mode||(U.settings.maxItems===1?"single":"multi");if(typeof U.settings.hideSelected!=="boolean"){U.settings.hideSelected=U.settings.mode==="multi"}U.initializePlugins(U.settings.plugins);U.setupCallbacks();U.setupTemplates();U.setup()};D.mixin(G);E.mixin(G);a.extend(G.prototype,{setup:function(){var ab=this;var ac=ab.settings;var Z=ab.eventNS;var U=a(window);var P=a(document);var T=ab.$input;var V;var N;var O;var Q;var R;var S;var aa;var ad;var ae;var W;var X;aa=ab.settings.mode;W=T.attr("class")||"";V=a("<div>").addClass(ac.wrapperClass).addClass(W).addClass(aa);N=a("<div>").addClass(ac.inputClass).addClass("items").appendTo(V);O=a('<input type="text" autocomplete="off" />').appendTo(N).attr("tabindex",T.is(":disabled")?"-1":ab.tabIndex);S=a(ac.dropdownParent||V);Q=a("<div>").addClass(ac.dropdownClass).addClass(aa).hide().appendTo(S);R=a("<div>").addClass(ac.dropdownContentClass).appendTo(Q);if(ab.settings.copyClassesToDropdown){Q.addClass(W)}V.css({width:T[0].style.width});if(ab.plugins.names.length){X="plugin-"+ab.plugins.names.join(" plugin-");V.addClass(X);Q.addClass(X)}if((ac.maxItems===null||ac.maxItems>1)&&ab.tagType===K){T.attr("multiple","multiple")}if(ab.settings.placeholder){O.attr("placeholder",ac.placeholder)}if(!ab.settings.splitOn&&ab.settings.delimiter){var Y=ab.settings.delimiter.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");ab.settings.splitOn=new RegExp("\\s*"+Y+"+\\s*")}if(T.attr("autocorrect")){O.attr("autocorrect",T.attr("autocorrect"))}if(T.attr("autocapitalize")){O.attr("autocapitalize",T.attr("autocapitalize"))}ab.$wrapper=V;ab.$control=N;ab.$control_input=O;ab.$dropdown=Q;ab.$dropdown_content=R;Q.on("mouseenter","[data-selectable]",function(){return ab.onOptionHover.apply(ab,arguments)});Q.on("mousedown click","[data-selectable]",function(){return ab.onOptionSelect.apply(ab,arguments)});M(N,"mousedown","*:not(input)",function(){return ab.onItemSelect.apply(ab,arguments)});b(O);N.on({mousedown:function(){return ab.onMouseDown.apply(ab,arguments)},click:function(){return ab.onClick.apply(ab,arguments)}});O.on({mousedown:function(af){af.stopPropagation()},keydown:function(){return ab.onKeyDown.apply(ab,arguments)},keyup:function(){return ab.onKeyUp.apply(ab,arguments)},keypress:function(){return ab.onKeyPress.apply(ab,arguments)},resize:function(){ab.positionDropdown.apply(ab,[])},blur:function(){return ab.onBlur.apply(ab,arguments)},focus:function(){ab.ignoreBlur=false;return ab.onFocus.apply(ab,arguments)},paste:function(){return ab.onPaste.apply(ab,arguments)}});P.on("keydown"+Z,function(af){ab.isCmdDown=af[k?"metaKey":"ctrlKey"];ab.isCtrlDown=af[k?"altKey":"ctrlKey"];ab.isShiftDown=af.shiftKey});P.on("keyup"+Z,function(af){if(af.keyCode===q){ab.isCtrlDown=false}if(af.keyCode===z){ab.isShiftDown=false}if(af.keyCode===o){ab.isCmdDown=false}});P.on("mousedown"+Z,function(af){if(ab.isFocused){if(af.target===ab.$dropdown[0]||af.target.parentNode===ab.$dropdown[0]){return false}if(!ab.$control.has(af.target).length&&af.target!==ab.$control[0]){ab.blur(af.target)}}});U.on(["scroll"+Z,"resize"+Z].join(" "),function(){if(ab.isOpen){ab.positionDropdown.apply(ab,arguments)}});U.on("mousemove"+Z,function(){ab.ignoreHover=false});this.revertSettings={$children:T.children().detach(),tabindex:T.attr("tabindex")};T.attr("tabindex",-1).hide().after(ab.$wrapper);if(a.isArray(ac.items)){ab.setValue(ac.items);delete ac.items}if(I){T.on("invalid"+Z,function(af){af.preventDefault();ab.isInvalid=true;ab.refreshState()})}ab.updateOriginalInput();ab.refreshItems();ab.refreshState();ab.updatePlaceholder();ab.isSetup=true;if(T.is(":disabled")){ab.disable()}ab.on("change",this.onChange);T.data("selectize",ab);T.addClass("selectized");ab.trigger("initialize");if(ac.preload===true){ab.onSearchChange("")}},setupTemplates:function(){var P=this;var N=P.settings.labelField;var O=P.settings.optgroupLabelField;var Q={optgroup:function(R){return'<div class="optgroup">'+R.html+"</div>"},optgroup_header:function(R,S){return'<div class="optgroup-header">'+S(R[O])+"</div>"},option:function(R,S){return'<div class="option">'+S(R[N])+"</div>"},item:function(R,S){return'<div class="item">'+S(R[N])+"</div>"},option_create:function(R,S){return'<div class="create">Add <strong>'+S(R.input)+"</strong>&hellip;</div>"}};P.settings.render=a.extend({},Q,P.settings.render)},setupCallbacks:function(){var P,O,N={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(P in N){if(N.hasOwnProperty(P)){O=this.settings[N[P]];if(O){this.on(P,O)}}}},onClick:function(N){var O=this;if(!O.isFocused){O.focus();N.preventDefault()}},onMouseDown:function(P){var Q=this;var O=P.isDefaultPrevented();var N=a(P.target);if(Q.isFocused){if(P.target!==Q.$control_input[0]){if(Q.settings.mode==="single"){Q.isOpen?Q.close():Q.open()}else{if(!O){Q.setActiveItem(null)}}return false}}else{if(!O){window.setTimeout(function(){Q.focus()},0)}}},onChange:function(){this.$input.trigger("change")},onPaste:function(N){var O=this;if(O.isFull()||O.isInputHidden||O.isLocked){N.preventDefault()}else{if(O.settings.splitOn){setTimeout(function(){var R=a.trim(O.$control_input.val()||"").split(O.settings.splitOn);for(var P=0,Q=R.length;P<Q;P++){O.createItem(R[P])}},0)}}},onKeyPress:function(O){if(this.isLocked){return O&&O.preventDefault()}var N=String.fromCharCode(O.keyCode||O.which);if(this.settings.create&&this.settings.mode==="multi"&&N===this.settings.delimiter){this.createItem();O.preventDefault();return false}},onKeyDown:function(P){var Q=P.target===this.$control_input[0];var R=this;if(R.isLocked){if(P.keyCode!==A){P.preventDefault()}return}switch(P.keyCode){case m:if(R.isCmdDown){R.selectAll();return}break;case t:if(R.isOpen){P.preventDefault();P.stopPropagation();R.close()}return;case v:if(!P.ctrlKey||P.altKey){break}case s:if(!R.isOpen&&R.hasOptions){R.open()}else{if(R.$activeOption){R.ignoreHover=true;var N=R.getAdjacentOption(R.$activeOption,1);if(N.length){R.setActiveOption(N,true,true)}}}P.preventDefault();return;case w:if(!P.ctrlKey||P.altKey){break}case B:if(R.$activeOption){R.ignoreHover=true;var O=R.getAdjacentOption(R.$activeOption,-1);if(O.length){R.setActiveOption(O,true,true)}}P.preventDefault();return;case x:if(R.isOpen&&R.$activeOption){R.onOptionSelect({currentTarget:R.$activeOption});P.preventDefault()}return;case u:R.advanceSelection(-1,P);return;case y:R.advanceSelection(1,P);return;case A:if(R.settings.selectOnTab&&R.isOpen&&R.$activeOption){R.onOptionSelect({currentTarget:R.$activeOption});if(!R.isFull()){P.preventDefault()}}if(R.settings.create&&R.createItem()){P.preventDefault()}return;case n:case r:R.deleteSelection(P);return}if((R.isFull()||R.isInputHidden)&&!(k?P.metaKey:P.ctrlKey)){P.preventDefault();return}},onKeyUp:function(N){var O=this;if(O.isLocked){return N&&N.preventDefault()}var P=O.$control_input.val()||"";if(O.lastValue!==P){O.lastValue=P;O.onSearchChange(P);O.refreshOptions();O.trigger("type",P)}},onSearchChange:function(P){var O=this;var N=O.settings.load;if(!N){return}if(O.loadedSearches.hasOwnProperty(P)){return}O.loadedSearches[P]=true;O.load(function(Q){N.apply(O,[P,Q])})},onFocus:function(N){var O=this;var P=O.isFocused;if(O.isDisabled){O.blur();N&&N.preventDefault();return false}if(O.ignoreFocus){return}O.isFocused=true;if(O.settings.preload==="focus"){O.onSearchChange("")}if(!P){O.trigger("focus")}if(!O.$activeItems.length){O.showInput();O.setActiveItem(null);O.refreshOptions(!!O.settings.openOnFocus)}O.refreshState()},onBlur:function(P,O){var Q=this;if(!Q.isFocused){return}Q.isFocused=false;if(Q.ignoreFocus){return}else{if(!Q.ignoreBlur&&document.activeElement===Q.$dropdown_content[0]){Q.ignoreBlur=true;Q.onFocus(P);return}}var N=function(){Q.close();Q.setTextboxValue("");Q.setActiveItem(null);Q.setActiveOption(null);Q.setCaret(Q.items.length);Q.refreshState();(O||document.body).focus();Q.ignoreFocus=false;Q.trigger("blur")};Q.ignoreFocus=true;if(Q.settings.create&&Q.settings.createOnBlur){Q.createItem(null,false,N)}else{N()}},onOptionHover:function(N){if(this.ignoreHover){return}this.setActiveOption(N.currentTarget,false)},onOptionSelect:function(P){var R,O,N,Q=this;if(P.preventDefault){P.preventDefault();P.stopPropagation()}O=a(P.currentTarget);if(O.hasClass("create")){Q.createItem(null,function(){if(Q.settings.closeAfterSelect){Q.close()}})}else{R=O.attr("data-value");if(typeof R!=="undefined"){Q.lastQuery=null;Q.setTextboxValue("");Q.addItem(R);if(Q.settings.closeAfterSelect){Q.close()}else{if(!Q.settings.hideSelected&&P.type&&/mouse/.test(P.type)){Q.setActiveOption(Q.getOption(R))}}}}},onItemSelect:function(N){var O=this;if(O.isLocked){return}if(O.settings.mode==="multi"){N.preventDefault();O.setActiveItem(N.currentTarget,N)}},load:function(O){var P=this;var N=P.$wrapper.addClass(P.settings.loadingClass);P.loading++;O.apply(P,[function(Q){P.loading=Math.max(P.loading-1,0);if(Q&&Q.length){P.addOption(Q);P.refreshOptions(P.isFocused&&!P.isInputHidden)}if(!P.loading){N.removeClass(P.settings.loadingClass)}P.trigger("load",Q)}])},setTextboxValue:function(P){var N=this.$control_input;var O=N.val()!==P;if(O){N.val(P).triggerHandler("update");this.lastValue=P}},getValue:function(){if(this.tagType===K&&this.$input.attr("multiple")){return this.items}else{return this.items.join(this.settings.delimiter)}},setValue:function(P,O){var N=O?[]:["change"];d(this,N,function(){this.clear(O);this.addItems(P,O)})},setActiveItem:function(N,Q){var W=this;var S;var T,U,P,R,V,X;var O;if(W.settings.mode==="single"){return}N=a(N);if(!N.length){a(W.$activeItems).removeClass("active");W.$activeItems=[];if(W.isFocused){W.showInput()}return}S=Q&&Q.type.toLowerCase();if(S==="mousedown"&&W.isShiftDown&&W.$activeItems.length){O=W.$control.children(".active:last");P=Array.prototype.indexOf.apply(W.$control[0].childNodes,[O[0]]);R=Array.prototype.indexOf.apply(W.$control[0].childNodes,[N[0]]);if(P>R){X=P;P=R;R=X}for(T=P;T<=R;T++){V=W.$control[0].childNodes[T];if(W.$activeItems.indexOf(V)===-1){a(V).addClass("active");W.$activeItems.push(V)}}Q.preventDefault()}else{if((S==="mousedown"&&W.isCtrlDown)||(S==="keydown"&&this.isShiftDown)){if(N.hasClass("active")){U=W.$activeItems.indexOf(N[0]);W.$activeItems.splice(U,1);N.removeClass("active")}else{W.$activeItems.push(N.addClass("active")[0])}}else{a(W.$activeItems).removeClass("active");W.$activeItems=[N.addClass("active")[0]]}}W.hideInput();if(!this.isFocused){W.focus()}},setActiveOption:function(N,R,O){var Q,P,V;var T,S;var U=this;if(U.$activeOption){U.$activeOption.removeClass("active")}U.$activeOption=null;N=a(N);if(!N.length){return}U.$activeOption=N.addClass("active");if(R||!l(R)){Q=U.$dropdown_content.height();P=U.$activeOption.outerHeight(true);R=U.$dropdown_content.scrollTop()||0;V=U.$activeOption.offset().top-U.$dropdown_content.offset().top+R;T=V;S=V-Q+P;if(V+P>Q+R){U.$dropdown_content.stop().animate({scrollTop:S},O?U.settings.scrollDuration:0)}else{if(V<R){U.$dropdown_content.stop().animate({scrollTop:T},O?U.settings.scrollDuration:0)}}}},selectAll:function(){var N=this;if(N.settings.mode==="single"){return}N.$activeItems=Array.prototype.slice.apply(N.$control.children(":not(input)").addClass("active"));if(N.$activeItems.length){N.hideInput();N.close()}N.focus()},hideInput:function(){var N=this;N.setTextboxValue("");N.$control_input.css({opacity:0,position:"absolute",left:N.rtl?10000:-10000});N.isInputHidden=true},showInput:function(){this.$control_input.css({opacity:1,position:"relative",left:0});this.isInputHidden=false},focus:function(){var N=this;if(N.isDisabled){return}N.ignoreFocus=true;N.$control_input[0].focus();window.setTimeout(function(){N.ignoreFocus=false;N.onFocus()},0)},blur:function(N){this.$control_input[0].blur();this.onBlur(null,N)},getScoreFunction:function(N){return this.sifter.getScoreFunction(N,this.getSearchOptions())},getSearchOptions:function(){var N=this.settings;var O=N.sortField;if(typeof O==="string"){O=[{field:O}]}return{fields:N.searchField,conjunction:N.searchConjunction,sort:O}},search:function(Q){var O,V,S,R,N;var T=this;var U=T.settings;var P=this.getSearchOptions();if(U.score){N=T.settings.score.apply(this,[Q]);if(typeof N!=="function"){throw new Error('Selectize "score" setting must be a function that returns a function')}}if(Q!==T.lastQuery){T.lastQuery=Q;R=T.sifter.search(Q,a.extend(P,{score:N}));T.currentResults=R}else{R=a.extend(true,{},T.currentResults)}if(U.hideSelected){for(O=R.items.length-1;O>=0;O--){if(T.items.indexOf(h(R.items[O].id))!==-1){R.items.splice(O,1)}}}return R},refreshOptions:function(ai){var X,Y,Z,aa,S,T,ad,ae,ab,ac,V,W,U;var N,O,P;if(typeof ai==="undefined"){ai=true}var ah=this;var af=a.trim(ah.$control_input.val());var ag=ah.search(af);var Q=ah.$dropdown_content;var R=ah.$activeOption&&h(ah.$activeOption.attr("data-value"));aa=ag.items.length;if(typeof ah.settings.maxOptions==="number"){aa=Math.min(aa,ah.settings.maxOptions)}S={};T=[];for(X=0;X<aa;X++){ad=ah.options[ag.items[X].id];ae=ah.render("option",ad);ab=ad[ah.settings.optgroupField]||"";ac=a.isArray(ab)?ab:[ab];for(Y=0,Z=ac&&ac.length;Y<Z;Y++){ab=ac[Y];if(!ah.optgroups.hasOwnProperty(ab)){ab=""}if(!S.hasOwnProperty(ab)){S[ab]=[];T.push(ab)}S[ab].push(ae)}}if(this.settings.lockOptgroupOrder){T.sort(function(aj,al){var ak=ah.optgroups[aj].$order||0;var am=ah.optgroups[al].$order||0;return ak-am})}V=[];for(X=0,aa=T.length;X<aa;X++){ab=T[X];if(ah.optgroups.hasOwnProperty(ab)&&S[ab].length){W=ah.render("optgroup_header",ah.optgroups[ab])||"";W+=S[ab].join("");V.push(ah.render("optgroup",a.extend({},ah.optgroups[ab],{html:W})))}else{V.push(S[ab].join(""))}}Q.html(V.join(""));if(ah.settings.highlight&&ag.query.length&&ag.tokens.length){for(X=0,aa=ag.tokens.length;X<aa;X++){i(Q,ag.tokens[X].regex)}}if(!ah.settings.hideSelected){for(X=0,aa=ah.items.length;X<aa;X++){ah.getOption(ah.items[X]).addClass("selected")}}U=ah.canCreate(af);if(U){Q.prepend(ah.render("option_create",{input:af}));P=a(Q[0].childNodes[0])}ah.hasOptions=ag.items.length>0||U;if(ah.hasOptions){if(ag.items.length>0){O=R&&ah.getOption(R);if(O&&O.length){N=O}else{if(ah.settings.mode==="single"&&ah.items.length){N=ah.getOption(ah.items[0])}}if(!N||!N.length){if(P&&!ah.settings.addPrecedence){N=ah.getAdjacentOption(P,1)}else{N=Q.find("[data-selectable]:first")}}}else{N=P}ah.setActiveOption(N);if(ai&&!ah.isOpen){ah.open()}}else{ah.setActiveOption(null);if(ai&&ah.isOpen){ah.close()}}},addOption:function(N){var O,P,R,Q=this;if(a.isArray(N)){for(O=0,P=N.length;O<P;O++){Q.addOption(N[O])}return}if(R=Q.registerOption(N)){Q.userOptions[R]=true;Q.lastQuery=null;Q.trigger("option_add",R,N)}},registerOption:function(N){var O=h(N[this.settings.valueField]);if(!O||this.options.hasOwnProperty(O)){return false}N.$order=N.$order||++this.order;this.options[O]=N;return O},registerOptionGroup:function(N){var O=h(N[this.settings.optgroupValueField]);if(!O){return false}N.$order=N.$order||++this.order;this.optgroups[O]=N;return O},addOptionGroup:function(O,N){N[this.settings.optgroupValueField]=O;if(O=this.registerOptionGroup(N)){this.trigger("optgroup_add",O,N)}},removeOptionGroup:function(N){if(this.optgroups.hasOwnProperty(N)){delete this.optgroups[N];this.renderCache={};this.trigger("optgroup_remove",N)}},clearOptionGroups:function(){this.optgroups={};this.renderCache={};this.trigger("optgroup_clear")},updateOption:function(V,R){var U=this;var N,O;var W,S,P,Q,T;V=h(V);W=h(R[U.settings.valueField]);if(V===null){return}if(!U.options.hasOwnProperty(V)){return}if(typeof W!=="string"){throw new Error("Value must be set in option data")}T=U.options[V].$order;if(W!==V){delete U.options[V];S=U.items.indexOf(V);if(S!==-1){U.items.splice(S,1,W)}}R.$order=R.$order||T;U.options[W]=R;P=U.renderCache.item;Q=U.renderCache.option;if(P){delete P[V];delete P[W]}if(Q){delete Q[V];delete Q[W]}if(U.items.indexOf(W)!==-1){N=U.getItem(V);O=a(U.render("item",R));if(N.hasClass("active")){O.addClass("active")}N.replaceWith(O)}U.lastQuery=null;if(U.isOpen){U.refreshOptions(false)}},removeOption:function(R,Q){var P=this;R=h(R);var N=P.renderCache.item;var O=P.renderCache.option;if(N){delete N[R]}if(O){delete O[R]}delete P.userOptions[R];delete P.options[R];P.lastQuery=null;P.trigger("option_remove",R);P.removeItem(R,Q)},clearOptions:function(){var N=this;N.loadedSearches={};N.userOptions={};N.renderCache={};N.options=N.sifter.items={};N.lastQuery=null;N.trigger("option_clear");N.clear()},getOption:function(N){return this.getElementWithValue(N,this.$dropdown_content.find("[data-selectable]"))},getAdjacentOption:function(N,P){var O=this.$dropdown.find("[data-selectable]");var Q=O.index(N)+P;return Q>=0&&Q<O.length?O.eq(Q):a()},getElementWithValue:function(Q,N){Q=h(Q);if(typeof Q!=="undefined"&&Q!==null){for(var O=0,P=N.length;O<P;O++){if(N[O].getAttribute("data-value")===Q){return a(N[O])}}}return a()},getItem:function(N){return this.getElementWithValue(N,this.$control.children())},addItems:function(R,Q){var O=a.isArray(R)?R:[R];for(var N=0,P=O.length;N<P;N++){this.isPending=(N<P-1);this.addItem(O[N],Q)}},addItem:function(P,O){var N=O?[]:["change"];d(this,N,function(){var Q,R,S;var W=this;var V=W.settings.mode;var U,T,X,Y;P=h(P);if(W.items.indexOf(P)!==-1){if(V==="single"){W.close()}return}if(!W.options.hasOwnProperty(P)){return}if(V==="single"){W.clear(O)}if(V==="multi"&&W.isFull()){return}Q=a(W.render("item",W.options[P]));Y=W.isFull();W.items.splice(W.caretPos,0,P);W.insertAtCaret(Q);if(!W.isPending||(!Y&&W.isFull())){W.refreshState()}if(W.isSetup){S=W.$dropdown_content.find("[data-selectable]");if(!W.isPending){R=W.getOption(P);X=W.getAdjacentOption(R,1).attr("data-value");W.refreshOptions(W.isFocused&&V!=="single");if(X){W.setActiveOption(W.getOption(X))}}if(!S.length||W.isFull()){W.close()}else{W.positionDropdown()}W.updatePlaceholder();W.trigger("item_add",P,Q);W.updateOriginalInput({silent:O})}})},removeItem:function(S,R){var Q=this;var N,O,P;N=(typeof S==="object")?S:Q.getItem(S);S=h(N.attr("data-value"));O=Q.items.indexOf(S);if(O!==-1){N.remove();if(N.hasClass("active")){P=Q.$activeItems.indexOf(N[0]);Q.$activeItems.splice(P,1)}Q.items.splice(O,1);Q.lastQuery=null;if(!Q.settings.persist&&Q.userOptions.hasOwnProperty(S)){Q.removeOption(S,R)}if(O<Q.caretPos){Q.setCaret(Q.caretPos-1)}Q.refreshState();Q.updatePlaceholder();Q.updateOriginalInput({silent:R});Q.positionDropdown();Q.trigger("item_remove",S,N)}},createItem:function(Q,U){var S=this;var O=S.caretPos;Q=Q||a.trim(S.$control_input.val()||"");var N=arguments[arguments.length-1];if(typeof N!=="function"){N=function(){}}if(typeof U!=="boolean"){U=true}if(!S.canCreate(Q)){N();return false}S.lock();var T=(typeof S.settings.create==="function")?this.settings.create:function(W){var V={};V[S.settings.labelField]=W;V[S.settings.valueField]=W;return V};var P=F(function(V){S.unlock();if(!V||typeof V!=="object"){return N()}var W=h(V[S.settings.valueField]);if(typeof W!=="string"){return N()}S.setTextboxValue("");S.addOption(V);S.setCaret(O);S.addItem(W);S.refreshOptions(U&&S.settings.mode!=="single");N(V)});var R=T.apply(this,[Q,P]);if(typeof R!=="undefined"){P(R)}return true},refreshItems:function(){this.lastQuery=null;if(this.isSetup){this.addItem(this.items)}this.refreshState();this.updateOriginalInput()},refreshState:function(){var N,O=this;if(O.isRequired){if(O.items.length){O.isInvalid=false}O.$control_input.prop("required",N)}O.refreshClasses()},refreshClasses:function(){var P=this;var N=P.isFull();var O=P.isLocked;P.$wrapper.toggleClass("rtl",P.rtl);P.$control.toggleClass("focus",P.isFocused).toggleClass("disabled",P.isDisabled).toggleClass("required",P.isRequired).toggleClass("invalid",P.isInvalid).toggleClass("locked",O).toggleClass("full",N).toggleClass("not-full",!N).toggleClass("input-active",P.isFocused&&!P.isInputHidden).toggleClass("dropdown-active",P.isOpen).toggleClass("has-options",!a.isEmptyObject(P.options)).toggleClass("has-items",P.items.length>0);P.$control_input.data("grow",!N&&!O)},isFull:function(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems},updateOriginalInput:function(R){var N,P,Q,O,S=this;R=R||{};if(S.tagType===K){Q=[];for(N=0,P=S.items.length;N<P;N++){O=S.options[S.items[N]][S.settings.labelField]||"";Q.push('<option value="'+e(S.items[N])+'" selected="selected">'+e(O)+"</option>")}if(!Q.length&&!this.$input.attr("multiple")){Q.push('<option value="" selected="selected"></option>')}S.$input.html(Q.join(""))}else{S.$input.val(S.getValue());S.$input.attr("value",S.$input.val())}if(S.isSetup){if(!R.silent){S.trigger("change",S.$input.val())}}},updatePlaceholder:function(){if(!this.settings.placeholder){return}var N=this.$control_input;if(this.items.length){N.removeAttr("placeholder")}else{N.attr("placeholder",this.settings.placeholder)}N.triggerHandler("update",{force:true})},open:function(){var N=this;if(N.isLocked||N.isOpen||(N.settings.mode==="multi"&&N.isFull())){return}N.focus();N.isOpen=true;N.refreshState();N.$dropdown.css({visibility:"hidden",display:"block"});N.positionDropdown();N.$dropdown.css({visibility:"visible"});N.trigger("dropdown_open",N.$dropdown)},close:function(){var N=this;var O=N.isOpen;if(N.settings.mode==="single"&&N.items.length){N.hideInput()}N.isOpen=false;N.$dropdown.hide();N.setActiveOption(null);N.refreshState();if(O){N.trigger("dropdown_close",N.$dropdown)}},positionDropdown:function(){var N=this.$control;var O=this.settings.dropdownParent==="body"?N.offset():N.position();O.top+=N.outerHeight(true);this.$dropdown.css({width:N.outerWidth(),top:O.top,left:O.left})},clear:function(O){var N=this;if(!N.items.length){return}N.$control.children(":not(input)").remove();N.items=[];N.lastQuery=null;N.setCaret(0);N.setActiveItem(null);N.updatePlaceholder();N.updateOriginalInput({silent:O});N.refreshState();N.showInput();N.trigger("clear")},insertAtCaret:function(N){var O=Math.min(this.caretPos,this.items.length);if(O===0){this.$control.prepend(N)}else{a(this.$control[0].childNodes[O]).before(N)}this.setCaret(O+1)},deleteSelection:function(R){var S,T,Q,V,X,P,U,N,O;var W=this;Q=(R&&R.keyCode===n)?-1:1;V=g(W.$control_input[0]);if(W.$activeOption&&!W.settings.hideSelected){U=W.getAdjacentOption(W.$activeOption,-1).attr("data-value")}X=[];if(W.$activeItems.length){O=W.$control.children(".active:"+(Q>0?"last":"first"));P=W.$control.children(":not(input)").index(O);if(Q>0){P++}for(S=0,T=W.$activeItems.length;S<T;S++){X.push(a(W.$activeItems[S]).attr("data-value"))}if(R){R.preventDefault();R.stopPropagation()}}else{if((W.isFocused||W.settings.mode==="single")&&W.items.length){if(Q<0&&V.start===0&&V.length===0){X.push(W.items[W.caretPos-1])}else{if(Q>0&&V.start===W.$control_input.val().length){X.push(W.items[W.caretPos])}}}}if(!X.length||(typeof W.settings.onDelete==="function"&&W.settings.onDelete.apply(W,[X])===false)){return false}if(typeof P!=="undefined"){W.setCaret(P)}while(X.length){W.removeItem(X.pop())}W.showInput();W.positionDropdown();W.refreshOptions(true);if(U){N=W.getOption(U);if(N.length){W.setActiveOption(N)}}return true},advanceSelection:function(P,Q){var U,S,R,V,O,N;var T=this;if(P===0){return}if(T.rtl){P*=-1}U=P>0?"last":"first";S=g(T.$control_input[0]);if(T.isFocused&&!T.isInputHidden){V=T.$control_input.val().length;O=P<0?S.start===0&&S.length===0:S.start===V;if(O&&!V){T.advanceCaret(P,Q)}}else{N=T.$control.children(".active:"+U);if(N.length){R=T.$control.children(":not(input)").index(N);T.setActiveItem(null);T.setCaret(P>0?R+1:R)}}},advanceCaret:function(O,P){var R=this,Q,N;if(O===0){return}Q=O>0?"next":"prev";if(R.isShiftDown){N=R.$control_input[Q]();if(N.length){R.hideInput();R.setActiveItem(N);P&&P.preventDefault()}}else{R.setCaret(R.caretPos+O)}},setCaret:function(Q){var T=this;if(T.settings.mode==="single"){Q=T.items.length}else{Q=Math.max(0,Math.min(T.items.length,Q))}if(!T.isPending){var R,S,P,O,N;O=T.$control.children(":not(input)");for(R=0,S=O.length;R<S;R++){N=a(O[R]).detach();if(R<Q){T.$control_input.before(N)}else{T.$control.append(N)}}}T.caretPos=Q},lock:function(){this.close();this.isLocked=true;this.refreshState()},unlock:function(){this.isLocked=false;this.refreshState()},disable:function(){var N=this;N.$input.prop("disabled",true);N.$control_input.prop("disabled",true).prop("tabindex",-1);N.isDisabled=true;N.lock()},enable:function(){var N=this;N.$input.prop("disabled",false);N.$control_input.prop("disabled",false).prop("tabindex",N.tabIndex);N.isDisabled=false;N.unlock()},destroy:function(){var P=this;var N=P.eventNS;var O=P.revertSettings;P.trigger("destroy");P.off();P.$wrapper.remove();P.$dropdown.remove();P.$input.html("").append(O.$children).removeAttr("tabindex").removeClass("selectized").attr({tabindex:O.tabindex}).show();P.$control_input.removeData("grow");P.$input.removeData("selectize");a(window).off(N);a(document).off(N);a(document.body).off(N);delete P.$input[0].selectize},render:function(U,O){var V,Q,R;var P="";var N=false;var T=this;var S=/^[\t \r\n]*<([a-z][a-z0-9\-_]*(?:\:[a-z][a-z0-9\-_]*)?)/i;if(U==="option"||U==="item"){V=h(O[T.settings.valueField]);N=!!V}if(N){if(!l(T.renderCache[U])){T.renderCache[U]={}}if(T.renderCache[U].hasOwnProperty(V)){return T.renderCache[U][V]}}P=T.settings.render[U].apply(this,[O,e]);if(U==="option"||U==="option_create"){P=P.replace(S,"<$1 data-selectable")}if(U==="optgroup"){Q=O[T.settings.optgroupValueField]||"";P=P.replace(S,'<$1 data-group="'+f(e(Q))+'"')}if(U==="option"||U==="item"){P=P.replace(S,'<$1 data-value="'+f(e(V||""))+'"')}if(N){T.renderCache[U][V]=P}return P},clearCache:function(O){var N=this;if(typeof O==="undefined"){N.renderCache={}}else{delete N.renderCache[O]}},canCreate:function(O){var P=this;if(!P.settings.create){return false}var N=P.settings.createFilter;return O.length&&(typeof N!=="function"||N.apply(P,[O]))&&(typeof N!=="string"||new RegExp(N).test(O))&&(!(N instanceof RegExp)||N.test(O))}});G.count=0;G.defaults={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:true,diacritics:true,create:false,createOnBlur:false,createFilter:null,highlight:true,openOnFocus:true,maxOptions:1000,maxItems:null,hideSelected:null,addPrecedence:false,selectOnTab:false,preload:false,allowEmptyOption:false,closeAfterSelect:false,scrollDuration:60,loadThrottle:300,loadingClass:"loading",dataAttr:"data-data",optgroupField:"optgroup",valueField:"value",labelField:"text",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:false,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"selectize-control",inputClass:"selectize-input",dropdownClass:"selectize-dropdown",dropdownContentClass:"selectize-dropdown-content",dropdownParent:null,copyClassesToDropdown:true,render:{}};a.fn.selectize=function(X){var O=a.fn.selectize.defaults;var W=a.extend({},O,X);var N=W.dataAttr;var P=W.labelField;var T=W.valueField;var Q=W.optgroupField;var R=W.optgroupLabelField;var S=W.optgroupValueField;var V=function(Y,ad){var aa,ab,af,ac;var Z=Y.attr(N);if(!Z){var ae=a.trim(Y.val()||"");if(!W.allowEmptyOption&&!ae.length){return}af=ae.split(W.delimiter);for(aa=0,ab=af.length;aa<ab;aa++){ac={};ac[P]=af[aa];ac[T]=af[aa];ad.options.push(ac)}ad.items=af}else{ad.options=JSON.parse(Z);for(aa=0,ab=ad.options.length;aa<ab;aa++){ad.items.push(ad.options[aa][T])}}};var U=function(Z,ai){var ac,ad,aj,Y,ag=0;var ae=ai.options;var af={};var ah=function(ak){var al=N&&ak.attr(N);if(typeof al==="string"&&al.length){return JSON.parse(al)}return null};var ab=function(ak,am){ak=a(ak);var ao=h(ak.attr("value"));if(!ao&&!W.allowEmptyOption){return}if(af.hasOwnProperty(ao)){if(am){var al=af[ao][Q];if(!al){af[ao][Q]=am}else{if(!a.isArray(al)){af[ao][Q]=[al,am]}else{al.push(am)}}}return}var an=ah(ak)||{};an[P]=an[P]||ak.text();an[T]=an[T]||ao;an[Q]=an[Q]||am;af[ao]=an;ae.push(an);if(ak.is(":selected")){ai.items.push(ao)}};var aa=function(ak){var am,ao,an,ap,al;ak=a(ak);an=ak.attr("label");if(an){ap=ah(ak)||{};ap[R]=an;ap[S]=an;ai.optgroups.push(ap)}al=a("option",ak);for(am=0,ao=al.length;am<ao;am++){ab(al[am],an)}};ai.maxItems=Z.attr("multiple")?null:1;Y=Z.children();for(ac=0,ad=Y.length;ac<ad;ac++){aj=Y[ac].tagName.toLowerCase();if(aj==="optgroup"){aa(Y[ac])}else{if(aj==="option"){ab(Y[ac])}}}};return this.each(function(){if(this.selectize){return}var Z;var Y=a(this);var ac=this.tagName.toLowerCase();var aa=Y.attr("placeholder")||Y.attr("data-placeholder");if(!aa&&!W.allowEmptyOption){aa=Y.children('option[value=""]').text()}var ab={placeholder:aa,options:[],optgroups:[],items:[]};if(ac==="select"){U(Y,ab)}else{V(Y,ab)}Z=new G(Y,a.extend(true,{},O,ab,X))})};a.fn.selectize.defaults=G.defaults;a.fn.selectize.support={validity:I};G.define("drag_drop",function(N){if(!a.fn.sortable){throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".')}if(this.settings.mode!=="multi"){return}var O=this;O.lock=(function(){var P=O.lock;return function(){var Q=O.$control.data("sortable");if(Q){Q.disable()}return P.apply(O,arguments)}})();O.unlock=(function(){var P=O.unlock;return function(){var Q=O.$control.data("sortable");if(Q){Q.enable()}return P.apply(O,arguments)}})();O.setup=(function(){var P=O.setup;return function(){P.apply(this,arguments);var Q=O.$control.sortable({items:"[data-value]",forcePlaceholderSize:true,disabled:O.isLocked,start:function(R,S){S.placeholder.css("width",S.helper.css("width"));Q.css({overflow:"visible"})},stop:function(){Q.css({overflow:"hidden"});var R=O.$activeItems?O.$activeItems.slice():null;var S=[];Q.children("[data-value]").each(function(){S.push(a(this).attr("data-value"))});O.setValue(S);O.setActiveItem(R)}})}})()});G.define("dropdown_header",function(N){var O=this;N=a.extend({title:"Untitled",headerClass:"selectize-dropdown-header",titleRowClass:"selectize-dropdown-header-title",labelClass:"selectize-dropdown-header-label",closeClass:"selectize-dropdown-header-close",html:function(P){return('<div class="'+P.headerClass+'"><div class="'+P.titleRowClass+'"><span class="'+P.labelClass+'">'+P.title+'</span><a href="javascript:void(0)" class="'+P.closeClass+'">&times;</a></div></div>')}},N);O.setup=(function(){var P=O.setup;return function(){P.apply(O,arguments);O.$dropdown_header=a(N.html(N));O.$dropdown.prepend(O.$dropdown_header)}})()});G.define("optgroup_columns",function(P){var Q=this;P=a.extend({equalizeWidth:true,equalizeHeight:true},P);this.getAdjacentOption=function(R,T){var S=R.closest("[data-group]").find("[data-selectable]");var U=S.index(R)+T;return U>=0&&U<S.length?S.eq(U):a()};this.onKeyDown=(function(){var R=Q.onKeyDown;return function(V){var W,T,U,S;if(this.isOpen&&(V.keyCode===u||V.keyCode===y)){Q.ignoreHover=true;S=this.$activeOption.closest("[data-group]");W=S.find("[data-selectable]").index(this.$activeOption);if(V.keyCode===u){S=S.prev("[data-group]")}else{S=S.next("[data-group]")}U=S.find("[data-selectable]");T=U.eq(Math.min(U.length-1,W));if(T.length){this.setActiveOption(T)}return}return R.apply(this,arguments)}})();var O=function(){var R;var T=O.width;var S=document;if(typeof T==="undefined"){R=S.createElement("div");R.innerHTML='<div style="width:50px;height:50px;position:absolute;left:-50px;top:-50px;overflow:auto;"><div style="width:1px;height:100px;"></div></div>';R=R.firstChild;S.body.appendChild(R);T=O.width=R.offsetWidth-R.clientWidth;S.body.removeChild(R)}return T};var N=function(){var T,U,S,V,W,X,R;R=a("[data-group]",Q.$dropdown_content);U=R.length;if(!U||!Q.$dropdown_content.width()){return}if(P.equalizeHeight){S=0;for(T=0;T<U;T++){S=Math.max(S,R.eq(T).height())}R.css({height:S})}if(P.equalizeWidth){X=Q.$dropdown_content.innerWidth()-O();V=Math.round(X/U);R.css({width:V});if(U>1){W=X-V*(U-1);R.eq(U-1).css({width:W})}}};if(P.equalizeHeight||P.equalizeWidth){j.after(this,"positionDropdown",N);j.after(this,"refreshOptions",N)}});G.define("remove_button",function(P){if(this.settings.mode==="single"){return}P=a.extend({label:"&times;",title:"Remove",className:"remove",append:true},P);var Q=this;var O='<a href="javascript:void(0)" class="'+P.className+'" tabindex="-1" title="'+e(P.title)+'">'+P.label+"</a>";var N=function(R,S){var T=R.search(/(<\/[^>]+>\s*)$/);return R.substring(0,T)+S+R.substring(T)};this.setup=(function(){var R=Q.setup;return function(){if(P.append){var S=Q.settings.render.item;Q.settings.render.item=function(T){return N(S.apply(this,arguments),O)}}R.apply(this,arguments);this.$control.on("click","."+P.className,function(U){U.preventDefault();if(Q.isLocked){return}var T=a(U.currentTarget).parent();Q.setActiveItem(T);if(Q.deleteSelection()){Q.setCaret(Q.items.length)}})}})()});G.define("restore_on_backspace",function(N){var O=this;N.text=N.text||function(P){return P[this.settings.labelField]};this.onKeyDown=(function(){var P=O.onKeyDown;return function(Q){var R,S;if(Q.keyCode===n&&this.$control_input.val()===""&&!this.$activeItems.length){R=this.caretPos-1;if(R>=0&&R<this.items.length){S=this.options[this.items[R]];if(this.deleteSelection(Q)){this.setTextboxValue(N.text.apply(this,[S]));this.refreshOptions(true)}Q.preventDefault();return}}return P.apply(this,arguments)}})()});return G}));